---
pagetitle: Modeling - Malaysia
output: 
  html_document:
    toc: true
    toc_float: true
    toc_collapsed: true
    toc_depth: 2
    number_sections: true
    theme: cosmo
    #inverse: true
---

```{r setup, echo = FALSE, message = FALSE, warning = FALSE}
knitr::opts_chunk$set(results = "hide", echo = FALSE, out.width = "75%", fig.align='center', message = F, warning = F, error = F, eval = T)

library(kableExtra)
library(dplyr)
library(gcamextractor)
library(rchart)
```


```{r child = 'header.rmd'}
```

<!-------------------------->
<!-------------------------->
# Download GCAM SE Asia
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="images/divider.png"></p>

<br>

```{r key-links-table, results = 'show', eval = TRUE, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

dt_url <- c("https://mega.nz/file/hNAyBACY#JrBcDtV4OKZItR7DY77n1nrp6b9hz_vjyXYA0TU5Hwc")

data.frame(
  File = c("gcamv5p3_seasia")) %>% 
  dplyr::mutate(Location = cell_spec(rep("Link",length(dt_url)),"html",link=dt_url)) %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("bordered","striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "#2A2A2A", color = "white")
```
<i>Note: You do not need a drop box account to download the file (just click the x and the download link will appear).</i>
<br>

<!-------------------------->
<!-------------------------->
# Guides
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="images/divider.png"></p>

<br>

```{r presentation-links-table, results = 'show', eval = TRUE, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

dt_url <- c("https://github.com/JGCRI/seasia/blob/main/modeling/gcam_overview.pdf",
            "https://github.com/JGCRI/seasia/blob/main/modeling/gcam_walkthrough.pdf")

data.frame(
  File = c("gcam_overview.pdf",
           "gcam_walkthrough.pdf"),
  Description = c("GCAM overview presentation",
                  "GCAM walkthrough presentation")) %>%
  dplyr::mutate(Location = cell_spec(rep("Link",length(dt_url)),"html",link=dt_url)) %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("bordered", "striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "#2A2A2A", color = "white")
```


<br>

<!-------------------------->
<!-------------------------->
# Scenarios
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="images/divider.png"></p>


```{r scenarios-links-table, results = 'show', eval = TRUE, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

dt_url <- c("https://github.com/JGCRI/seasia/blob/main/modeling/configuration_seasia_cities_bau.xml",
            "https://github.com/JGCRI/seasia/blob/main/modeling/thailand/configuration_seasia_cities_thailand_policy.xml")

data.frame(
  File = c("configuration_seasia_cities_bau.xml",
           "configuration_seasia_cities_thailand_policy.xml"),
  Description = c("Business as Usual Scenario",
                  "Example Policies Scenario")) %>%
  dplyr::mutate(Location = cell_spec(rep("Link",length(dt_url)),"html",link=dt_url)) %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("bordered","striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "#2A2A2A", color = "white")
```



<!-------------------------->
<!-------------------------->
# Example Policies
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="images/divider.png"></p>

The following table lists an example policy that has been modeled in GCAM. The section below explains what this policy is meant to represent and how to change it for future modeling by walking through the goal, approach, background, and GCAM implementation process. This policy is added on in the `configuration_seasia_cities_thailand_policy.xml` file to include it in the example policy scenario.

```{r policy-links-table, results = 'show', eval=TRUE, echo=FALSE, warning=FALSE, error = FALSE, message = FALSE}

dt_url <- c("https://github.com/JGCRI/seasia/blob/main/modeling/thailand/thailand_policy_national_electricity_generation_floor_pdp2018.xml")

data.frame(
  Description = c("Electricity Generation Mix - Subsidy: Modify the electricity generation mix by setting generation floors for each technology using a subsidy policy"),
  File = c("thailand_policy_national_electricity_generation_floor_pdp2018.xml")) %>%
  dplyr::mutate(Location = cell_spec(rep("Link",length(dt_url)),"html",link=dt_url)) %>%
  kable("html", escape = FALSE) %>%
  kable_styling(bootstrap_options = c("bordered","striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "#2A2A2A", color = "white")
```

## Electricity Generation Mix - Subsidy
***

```{r electricity-generation-files-table, results = 'show', eval = TRUE, echo = FALSE, warning = FALSE, error = FALSE, message = FALSE}

dt_url <- c("https://github.com/JGCRI/seasia/blob/main/data/thailand/inputs/thailand_bau_electricity_generation_2018_to_2037.csv",
            "https://github.com/JGCRI/seasia/blob/main/modeling/thailand/thailand_policy_national_electricity_generation_floor_pdp2018.xml")

data.frame(
  "Files Used" = c("thailand_bau_electricity_generation_2018_to_2037.csv",
                   "thailand_policy_national_electricity_generation_floor_pdp2018.xml"),
  Description = c("Desired electricity generation by fuel from 2018 to 2037 (based on PDP2018)",
                  "XML structure to implement generation floors matching the desired generation by fuel")) %>%
  dplyr::mutate(Location = cell_spec(rep("Link",length(dt_url)),"html",link=dt_url)) %>%
  kable("html", escape = FALSE, col.names = c("Files Used", "Description", "Link")) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive")) %>%
  row_spec(0, background = "#2A2A2A", color = "white")
```


<!-------------------------->
<!----------Goal------------>
<!-------------------------->

<div class="warning" style='background-color:#E1F4F5; border-left: solid #1f1f1f 4px; border-radius: 4px; padding:0.7em;'>
<span>
<h3 style='text-align:center; font-size:24px'>
<b>Goal</b>
</h3>

<p style='margin-left:1em;'>
The goal of this example is to set a minimum value (floor) in GCAM for the amount of electricity generation from each fuel type (coal, natural gas, hydropower, solar, etc.) corresponding with the planned capacities in the PDP2018. 

</p>
</span>
</div>

<br>


<!-------------------------->
<!--------Approach---------->
<!-------------------------->

<div class="warning" style='background-color:#fffae0; border-left: solid #1f1f1f 4px; border-radius: 4px; padding:0.7em;'>
<span>

<h3 style='text-align:center; font-size:24px'>
<b>Approach</b></h3>

<p style='margin-left:1em;'>
One way to set a generation floor for each fuel type in GCAM is to use a subsidy policy. This will lower the cost of the electricity generation technology until the floor is reached. If there is more demand for electricity than is supplied by the sum of the generation floors, then the remaining demand will be met by a mix of fuels determined by the market.

</p>
</span>
</div>

<br>


<!-------------------------->
<!--------Background-------->
<!-------------------------->

```{r child = 'background_policy-portfolio-standards.rmd'}
```


<!-------------------------->
<!---GCAM Implementation---->
<!-------------------------->

<div class="warning" style='background-color:#F5E5E1; border-left: solid #1f1f1f 4px; border-radius: 4px; padding:0.7em;'>
<span>
<h3 style='text-align:center; font-size:24px'>
<b>GCAM Implementation</b>
</h3>

<p style='margin-left:1em;'>
1. Create a folder in the input directory eg. `./gcam-core/input/addons`.
2. Download the example xml file [thailand_policy_national_electricity_generation_floor_pdp2018.xml](https://github.com/JGCRI/seasia/blob/main/modeling/thailand/thailand_policy_national_electricity_generation_floor_pdp2018.xml) to the folder.
4. Within each `policy-portfolio-standard` tag in the XML, adjust the following:
</p>

<ul style='margin-left:4em; text-align:left;'>
  <li>`constraint` for each year in which a floor is desired</li>
  <li>Set `min-price` to a large negative value for years in which an exact constraint, rather than a floor, is desired</li>
</ul>
<p style='margin-left:1em;'>
5. Within each `supplysector` tag in the XML, make sure that the corresponding `input-subsidy` is added within each relevant `period` for each `stub-technology` you wish to constrain.
6. Save the xml and then point to it in your configuration file by adding the line: 
<p style='font-size:0.8em'>
`<Value name = "scen">../input/addons/thailand/thailand_policy_national_electricity_generation_floor_pdp2018.xml</Value>`

</p>
</p>

</span>
</div>

<br>

<!-------------------------->
<!-------------------------->
# Diagnostics
<!-------------------------->
<!-------------------------->
<p align="center"> <img src="images/divider.png"></p>

This section describes how to explore and compare the final output data using various tools.

## Model Interface

## Extract GCAM Data

`gcamextractor` is an R package used to extract and process GCAM data and manipulate into standardized tables. `gcamextractor` converts GCAM outputs into commonly used units as well as aggregates across different classes and sectors for easy use in plots, maps and tables. For more information, please reference the documentation page found [here](https://jgcri.github.io/gcamextractor/index.html).

The first step is to create a path to the GCAM database, found ____, and a list of desired parameters. The `readgcam()` function also requires region names and a specific output folder. Because reading in many parameters can take several minutes, we will be using existing outputs, found in "gcamextractor/sample", generated by the code below.

```{r gcamextractor-setup, echo = TRUE, eval = FALSE}
sample_path <- "."

sample_params <- "pop"

regions <- c("Malaysia", "KualaLumpur", "Rest of Malaysia")

data <- gcamextractor::readgcam(gcamdatabase = sample_path,
                                paramsSelect = sample_params,
                                regionsSelect = regions,
                                regionsAggregate = list(regions),
                                regionsAggregateNames = "All of Malaysia",
                                folder = "gcamextractor/sample")

```

```{r gcamextractor}
df1 <- read.csv()
df2 <- read.csv()

malaysia <- df1 %>%
  filter(region %in% c("All of Malaysia", "KualaLumpur"),
         scenario = "Ref",
         x > 2000)

malaysia_class2 <- df2 %>%
  filter(region %in% c("All of Malaysia", "KualaLumpur"),
         scenario = "Ref",
         x > 2000)
```


## Plot Figures

`rchart` is a comprehensive charting package to plot and compare data across scenarios, regions, sectors and time periods in GCAM.

```{r rchart}


```


# {.unlisted .unnumbered}
```{r child = 'footer.rmd'}
```
